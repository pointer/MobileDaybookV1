webpackJsonp([2,0],{0:function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}var i=n(225),a=s(i),o=n(210),r=(s(o),n(209)),l=s(r),c=n(206),u=(s(c),n(205)),d=(s(u),n(162)),f=s(d),v=n(215),_=s(v);a.default.use(l.default),new a.default({el:"#app",template:"<app/>",framework7:{root:"#app",theme:"md",routes:f.default},components:{app:_.default}}).$mount("#app")},162:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=[{path:"/about/",component:n(216),name:"about"},{path:"/activities/",component:n(217),name:"activities"},{path:"/punchclock/",component:n(219),name:"punchclock"},{path:"/incident/",component:n(218),name:"incident"}]},163:function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(25),a=s(i);e.default={data:function(){return{signInOutTitle:"Sign In",loginScreenOpened:!1,username:null,password:null,baseUrl:null,uid:null,todos:[],errors:[],isLoggedIn:!1,loginTitle:"Connecter",loginScreenTitle:"Entrer"}},created:function(){this.baseUrl=window.localStorage.getItem("baseUrl"),this.username=window.localStorage.getItem("username")},mounted:function(){},methods:{setTitles:function(t){var e=this;t===!1?(e.loginTitle="Connecter",e.signInOutTitle="Sign In",e.loginScreenTitle="Entrer"):(e.loginTitle="Deconnecter",e.signInOutTitle="Sign Out",e.loginScreenTitle="Sortir")},signInOut:function(){var t=this;return t.isLoggedIn===!0?t.signOut():t.signIn()},signIn:function(){var t=this,e=this;if(console.log(e.baseUrl),window.localStorage.getItem("baseUrl")||window.localStorage.setItem("baseUrl",this.baseUrl),!e.baseUrl)return e.errors.push("Ajouter Adresse du site"),!1;var n=e.baseUrl+"/user/login?_format=json";console.log(e.username),console.log(e.password);var s={method:"POST",body:(0,a.default)({name:e.username,pass:e.password}),form_id:"user_login_form",dataType:"json",headers:{"Content-Type":"application/json"}};window.fetch(n,s).then(function(t){return t.json()}).then(function(n){e.isLoggedIn=!0;var s=n.current_user.uid;return window.localStorage.setItem("uid",n.current_user.uid),window.localStorage.setItem("username",n.current_user.name),window.sessionStorage.setItem("password",t.password),window.localStorage.setItem("csrfToken",n.csrf_token),window.localStorage.setItem("logoutToken",n.logout_token),window.localStorage.setItem("isLoggedIn","true"),window.alert(""),s}).then(function(t){var n=window.sessionStorage.getItem("password"),s=window.localStorage.getItem("username"),i=window.btoa(s+":"+n),a="Basic "+i,o=window.sessionStorage.getItem("csrfToken"),r=e.baseUrl+"/api/activities/"+t+"?_format=json",l={method:"GET",dataType:"json",headers:{Authorization:a,"X-CSRF-Token":o,Accept:"application/json","Content-Type":"application/json"}};return window.fetch(r,l)}).then(function(t){return t.json()}).then(function(t){return t}).then(function(t){e.formatTodos(t),e.setTitles(!0)}).catch(function(t){console.debug(t)})},signOut:function(){var t=this,e=this,n=window.localStorage.getItem("logoutToken"),s=window.localStorage.getItem("csrfToken"),i=e.baseUrl+"/user/logout?csrf_token="+s,a={method:"POST",logout_token:n};window.fetch(i,a).then(function(t){return t.json()}).then(function(t){return t}).then(function(n){console.log(n),window.localStorage.setItem("isLoggedIn","false"),e.isLoggedIn=!1,t.setTitles(!1)}).catch(function(t){console.debug(t)})},formatTodos:function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e].activity_start_date.split("T"),s=t[e].activity_end_date.split("T");t[e].activity_start_date=n[0],t[e].activity_start_time=n[1],t[e].activity_end_date=s[0],t[e].activity_end_time=s[1]}t=(0,a.default)(t),window.sessionStorage.setItem("todos",t)}}}},164:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={}},165:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{todos:[]}},mounted:function(){this.todos=JSON.parse(window.sessionStorage.getItem("todos"))},components:{},methods:{}}},166:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={mounted:function(){var t=window.localStorage.getItem("baseUrl");if(t){var e=t+"/user/login";window.open(e)}}}},167:function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(25),a=s(i),o=n(168),r=s(o),l=n(1),c=s(l);e.default={data:function(){return{username:"",lat:"",lng:"",punchDate:"",site:"",hasPunched:"false",navTitle:"Prise de service",baseUrl:"",token:"",uid:"",password:""}},mounted:function(){this.getPunchData();var t=this.punchStatus();"true"===t?this.navTitle="Fin de service":this.navTitle="Prise de service",this.baseUrl=window.localStorage.getItem("baseUrl"),this.username=window.localStorage.getItem("username"),this.token=window.localStorage.getItem("csrfToken"),this.uid=window.localStorage.getItem("uid"),this.password=window.sessionStorage.getItem("password")},methods:{onSend:function(){var t=this,e=this.punchStatus();"true"===e?t.punchOut():t.punchIn()},getPunchData:function(){var t=this;t.getCoordinates().then(function(t){return t},function(t){return console.warn("failed to obtain coordinates - ",t),{lat:null,long:null}}).then(function(e){t.showData(e)}).catch(function(t){console.error("error: ",t)})},getCoordinates:function(){return new r.default(function(t,e){function n(n){var s="";try{s={lat:n.coords.latitude,lng:n.coords.longitude}}catch(t){return e(t)}return t(s)}if(!("geolocation"in navigator&&"getCurrentPosition"in navigator.geolocation))return r.default.reject(new Error("geolocation API not available"));var s={timeout:1e4};navigator.geolocation.getCurrentPosition(n,e,s)})},punchOut:function(){var t=this,e=t.baseUrl+"/rest/session/token",n=window.sessionStorage.getItem("uuid"),s=window.sessionStorage.getItem("password"),i=window.localStorage.getItem("username"),o=window.btoa(i+":"+s),r="Basic "+o,l=t.baseUrl+"/jsonapi/daybook_duty_taking/"+n;window.fetch(e).then(function(t){return t.text()}).then(function(e){var s={data:{type:"node--daybook_duty_taking",id:n,attributes:{field_dbk_duty_taking_end:t.punchDate,field_dbk_duty_taking_geo_end:{lat:t.lat,lng:t.lng}}}},i={method:"PATCH",body:(0,a.default)(s),headers:{Authorization:r,"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json","X-CSRF-Token":e,"Cache-Control":"no-cache"}};window.fetch(l,i).then(function(t){return t.json()}).then(function(t){window.localStorage.setItem("hasPunched","false"),console.log(t)})}).catch(function(t){console.debug(t)})},punchIn:function(){var t=this,e=window.btoa(t.username+":"+t.password),n="Basic "+e,s=t.baseUrl+"/jsonapi/daybook_duty_taking?_format=api_json",i={data:{type:"node--daybook_duty_taking",attributes:{status:!0,title:t.username,field_dbk_duty_taking_agent:t.username,field_dbk_duty_taking_agent_id:t.uid,field_dbk_duty_taking_site:t.site,field_dbk_duty_taking_start:t.punchDate,field_dbk_duty_taking_geo_start:{lat:t.lat,lng:t.lng}}}},o={method:"POST",body:(0,a.default)(i),headers:{Authorization:n,"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json","X-CSRF-Token":t.token,"Cache-Control":"no-cache"}};window.fetch(s,o).then(function(t){return t.json()}).then(function(t){window.localStorage.setItem("hasPunched","true"),window.sessionStorage.setItem("id",t.data.id),window.sessionStorage.setItem("uuid",t.data.attributes.uuid),window.sessionStorage.setItem("nid",t.data.attributes.nid),console.log(t)}).catch(function(t){console.debug(t)})},showData:function(t){var e=this,n=new Date;n.setSeconds(0),n.setMilliseconds(0),e.punchDate=n.toISOString().split(".")[0],e.lat=t.lat,e.lng=t.lng;var s=(0,c.default)().startOf("day"),i=JSON.parse(window.sessionStorage.getItem("todos"));for(var a in i)if(i.hasOwnProperty(a)){var o=(0,c.default)(i[a].activity_start_date,"YYYY-MM-DD"),r=c.default.duration(o.diff(s)).asDays();0===r&&(e.site=i[a].activity_site)}e.username=window.localStorage.getItem("username")},punchStatus:function(){return this.hasPunched=window.localStorage.getItem("hasPunched"),this.hasPunched},getCsrfToken:function(){var t=this;window.fetch("http://localhost/rest/session/token").then(function(t){if(!t.ok)throw Error(t.statusText);return t.text()}).then(function(t){var e=t;window.sessionStorage.setItem("csrfToken",t),console.log(e)}).then(function(e){t.onSend()}).catch(function(t){console.debug(t)})}}}},205:function(t,e){},206:function(t,e){},207:function(t,e){},208:function(t,e){},211:function(t,e,n){function s(t){return n(i(t))}function i(t){return a[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var a={"./af":39,"./af.js":39,"./ar":46,"./ar-dz":40,"./ar-dz.js":40,"./ar-kw":41,"./ar-kw.js":41,"./ar-ly":42,"./ar-ly.js":42,"./ar-ma":43,"./ar-ma.js":43,"./ar-sa":44,"./ar-sa.js":44,"./ar-tn":45,"./ar-tn.js":45,"./ar.js":46,"./az":47,"./az.js":47,"./be":48,"./be.js":48,"./bg":49,"./bg.js":49,"./bm":50,"./bm.js":50,"./bn":51,"./bn.js":51,"./bo":52,"./bo.js":52,"./br":53,"./br.js":53,"./bs":54,"./bs.js":54,"./ca":55,"./ca.js":55,"./cs":56,"./cs.js":56,"./cv":57,"./cv.js":57,"./cy":58,"./cy.js":58,"./da":59,"./da.js":59,"./de":62,"./de-at":60,"./de-at.js":60,"./de-ch":61,"./de-ch.js":61,"./de.js":62,"./dv":63,"./dv.js":63,"./el":64,"./el.js":64,"./en-au":65,"./en-au.js":65,"./en-ca":66,"./en-ca.js":66,"./en-gb":67,"./en-gb.js":67,"./en-ie":68,"./en-ie.js":68,"./en-il":69,"./en-il.js":69,"./en-nz":70,"./en-nz.js":70,"./eo":71,"./eo.js":71,"./es":74,"./es-do":72,"./es-do.js":72,"./es-us":73,"./es-us.js":73,"./es.js":74,"./et":75,"./et.js":75,"./eu":76,"./eu.js":76,"./fa":77,"./fa.js":77,"./fi":78,"./fi.js":78,"./fo":79,"./fo.js":79,"./fr":82,"./fr-ca":80,"./fr-ca.js":80,"./fr-ch":81,"./fr-ch.js":81,"./fr.js":82,"./fy":83,"./fy.js":83,"./gd":84,"./gd.js":84,"./gl":85,"./gl.js":85,"./gom-latn":86,"./gom-latn.js":86,"./gu":87,"./gu.js":87,"./he":88,"./he.js":88,"./hi":89,"./hi.js":89,"./hr":90,"./hr.js":90,"./hu":91,"./hu.js":91,"./hy-am":92,"./hy-am.js":92,"./id":93,"./id.js":93,"./is":94,"./is.js":94,"./it":95,"./it.js":95,"./ja":96,"./ja.js":96,"./jv":97,"./jv.js":97,"./ka":98,"./ka.js":98,"./kk":99,"./kk.js":99,"./km":100,"./km.js":100,"./kn":101,"./kn.js":101,"./ko":102,"./ko.js":102,"./ky":103,"./ky.js":103,"./lb":104,"./lb.js":104,"./lo":105,"./lo.js":105,"./lt":106,"./lt.js":106,"./lv":107,"./lv.js":107,"./me":108,"./me.js":108,"./mi":109,"./mi.js":109,"./mk":110,"./mk.js":110,"./ml":111,"./ml.js":111,"./mn":112,"./mn.js":112,"./mr":113,"./mr.js":113,"./ms":115,"./ms-my":114,"./ms-my.js":114,"./ms.js":115,"./mt":116,"./mt.js":116,"./my":117,"./my.js":117,"./nb":118,"./nb.js":118,"./ne":119,"./ne.js":119,"./nl":121,"./nl-be":120,"./nl-be.js":120,"./nl.js":121,"./nn":122,"./nn.js":122,"./pa-in":123,"./pa-in.js":123,"./pl":124,"./pl.js":124,"./pt":126,"./pt-br":125,"./pt-br.js":125,"./pt.js":126,"./ro":127,"./ro.js":127,"./ru":128,"./ru.js":128,"./sd":129,"./sd.js":129,"./se":130,"./se.js":130,"./si":131,"./si.js":131,"./sk":132,"./sk.js":132,"./sl":133,"./sl.js":133,"./sq":134,"./sq.js":134,"./sr":136,"./sr-cyrl":135,"./sr-cyrl.js":135,"./sr.js":136,"./ss":137,"./ss.js":137,"./sv":138,"./sv.js":138,"./sw":139,"./sw.js":139,"./ta":140,"./ta.js":140,"./te":141,"./te.js":141,"./tet":142,"./tet.js":142,"./tg":143,"./tg.js":143,"./th":144,"./th.js":144,"./tl-ph":145,"./tl-ph.js":145,"./tlh":146,"./tlh.js":146,"./tr":147,"./tr.js":147,"./tzl":148,"./tzl.js":148,"./tzm":150,"./tzm-latn":149,"./tzm-latn.js":149,"./tzm.js":150,"./ug-cn":151,"./ug-cn.js":151,"./uk":152,"./uk.js":152,"./ur":153,"./ur.js":153,"./uz":155,"./uz-latn":154,"./uz-latn.js":154,"./uz.js":155,"./vi":156,"./vi.js":156,"./x-pseudo":157,"./x-pseudo.js":157,"./yo":158,"./yo.js":158,"./zh-cn":159,"./zh-cn.js":159,"./zh-hk":160,"./zh-hk.js":160,"./zh-tw":161,"./zh-tw.js":161};s.keys=function(){return Object.keys(a)},s.resolve=i,t.exports=s,s.id=211},215:function(t,e,n){n(208);var s=n(10)(n(163),n(223),"data-v-7ee8e50c",null);t.exports=s.exports},216:function(t,e,n){var s=n(10)(n(164),n(222),null,null);t.exports=s.exports},217:function(t,e,n){n(207);var s=n(10)(n(165),n(220),"data-v-586e6afc",null);t.exports=s.exports},218:function(t,e,n){var s=n(10)(n(166),n(224),null,null);t.exports=s.exports},219:function(t,e,n){var s=n(10)(n(167),n(221),null,null);t.exports=s.exports},220:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{title:"Activités","back-link":"Back"}}),t._v(" "),n("div",{staticClass:"page-content"},[n("div",{staticClass:"content-block-title"},[t._v("Liste des Affectations")]),t._v(" "),n("div",{staticClass:"list-block accordion-list"},[n("ul",t._l(t.todos,function(e){return n("li",{key:e.title,staticClass:"accordion-item"},[n("a",{staticClass:"item-content item-link",attrs:{href:"#"}},[n("div",{staticClass:"item-inner"},[n("div",{staticClass:"item-title"},[t._v(t._s(e.activity_start_date)+" ")]),t._v(" "),n("div",{staticClass:"item-after"},[n("span",{staticClass:"badge color-blue"},[t._v(t._s(e.activity_start_time))])])])]),t._v(" "),n("div",{staticClass:"accordion-item-content"},[n("div",{staticClass:"content-block"},[n("h2",[n("strong",[n("em",[t._v(t._s(e.activity_site))])])]),t._v(" "),n("p",[n("span",[t._v(t._s(e.activity_start_date))]),t._v(" "),n("span"),t._v(" "),n("span",[t._v(" "+t._s(e.activity_start_time))]),t._v(" "),n("span",[t._v(" - ")]),t._v(" "),n("span",[t._v(t._s(e.activity_end_date))]),t._v(" "),n("span"),t._v(" "),n("span",[t._v(t._s(e.activity_end_time))])]),t._v(" "),n("p",[n("span",[t._v(t._s(e.activity_site_street))]),t._v(" "),n("span",[t._v(t._s(e.activity_site_city))]),t._v(" "),n("span",[t._v(t._s(e.activity_site_postal_code))])]),t._v(" "),n("p",[t._v(t._s(e.activity_task))])])])])}))])])],1)},staticRenderFns:[]}},221:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",{attrs:{name:"punchclock"}},[n("f7-navbar",{attrs:{title:t.navTitle,"back-link":"Retour",sliding:""}}),t._v(" "),n("f7-block",[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[t._v(t._s(t.site))]),t._v(" "),n("div",{staticClass:"card-content"},[n("div",{staticClass:"list media-list"},[n("ul",[n("li",{staticClass:"item-content"},[n("div",{staticClass:"item-inner"},[n("div",{staticClass:"item-title-row"},[n("div",{staticClass:"item-title"},[t._v("Usager: "+t._s(t.username))])])])]),t._v(" "),n("li",{staticClass:"item-content"},[n("div",{staticClass:"item-inner"},[n("div",{staticClass:"item-title-row"},[n("div",{staticClass:"item-title"},[t._v("Date: "+t._s(t.punchDate))])])])]),t._v(" "),n("li",{staticClass:"item-content"},[n("div",{staticClass:"item-inner"},[n("div",{staticClass:"item-title-row"},[n("div",{staticClass:"item-title"},[t._v("Latitude: "+t._s(t.lat))])])])]),t._v(" "),n("li",{staticClass:"item-content"},[n("div",{staticClass:"item-inner"},[n("div",{staticClass:"item-title-row"},[n("div",{staticClass:"item-title"},[t._v("Longitude: "+t._s(t.lng))])])])])]),t._v(" "),n("f7-list",[n("f7-list-button",{attrs:{title:"Envoyer"},on:{click:t.onSend}})],1)],1)])])])],1)},staticRenderFns:[]}},222:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{title:"About","back-link":"Retour",sliding:""}}),t._v(" "),n("f7-block",{attrs:{inner:""}},[n("p",[t._v("Mobile Daybook")]),t._v(" "),n("p",[t._v("Retour"),n("f7-link",{attrs:{back:""}},[t._v("back")]),t._v(".")],1),t._v(" "),n("p"),t._v(" "),n("p")])],1)},staticRenderFns:[]}},223:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("f7-statusbar"),t._v(" "),n("f7-views",[n("f7-view",{attrs:{id:"main-view","navbar-through":"","dynamic-navbar":!0,main:""}},[n("f7-navbar",[n("f7-nav-left",[n("f7-link",{attrs:{icon:"icon-bars","open-panel":"left"}})],1),t._v(" "),n("f7-nav-center",{attrs:{sliding:""}},[t._v("Mobile Daybook")]),t._v(" "),n("f7-nav-right",[n("f7-link",{attrs:{icon:"icon-bars","open-panel":"right"}})],1)],1),t._v(" "),n("f7-pages",[t.errors.length?n("p",[n("b",[t._v("SVP Corriger le(s)s erreur(s) suivante(s):")]),t._v(" "),n("ul",t._l(t.errors,function(e){return n("li",[t._v(t._s(e))])}))]):t._e(),t._v(" "),n("f7-page",[n("f7-block-title",[t._v("Navigation")]),t._v(" "),n("f7-list",[n("f7-list-item",{attrs:{link:"/about/",title:"About"}}),t._v(" "),n("f7-list-item",{attrs:{link:"/activities/",title:"Activités"}}),t._v(" "),n("f7-list-item",{attrs:{link:"/punchclock/",title:"Service"}}),t._v(" "),n("f7-list-item",{attrs:{link:"/incident/",title:"Incident"}})],1),t._v(" "),n("f7-block-title",[t._v("Themes")]),t._v(" "),n("f7-list",[n("f7-list-item",{attrs:{title:"iOS Theme",external:"",link:"./index.html?theme=ios"}}),t._v(" "),n("f7-list-item",{attrs:{title:"Material (MD) Theme",external:"",link:"./index.html?theme=md"}})],1),t._v(" "),n("f7-block",[n("f7-grid",[n("f7-col",{attrs:{width:"50"}},[n("f7-button",{class:[t.isLoggedIn?"col button color-red":"col button color-green"],attrs:{"open-login-screen":"#login-screen",title:t.loginTitle},model:{value:t.loginTitle,callback:function(e){t.loginTitle=e},expression:"loginTitle"}},[t._v(t._s(t.loginTitle))])],1)],1)],1)],1)],1)],1)],1),t._v(" "),n("f7-login-screen",{attrs:{id:"login-screen"}},[n("f7-view",[n("f7-pages",[n("f7-page",{attrs:{"login-screen":""}},[n("f7-login-screen-title",{model:{value:t.loginScreenTitle,callback:function(e){t.loginScreenTitle=e},expression:"loginScreenTitle"}},[t._v(t._s(t.loginScreenTitle))]),t._v(" "),n("f7-list",{attrs:{form:""}},[n("f7-list-item",{staticClass:"control"},[n("f7-label",[t._v("Entrer https:// URL:")]),t._v(" "),n("f7-input",{attrs:{type:"url",name:"baseurl",id:"baseurl",placeholder:"https://example.com",pattern:"https://.*",size:"20",required:"","clear-button":""},model:{value:t.baseUrl,callback:function(e){t.baseUrl=e},expression:"baseUrl"}})],1),t._v(" "),n("f7-list-item",[n("f7-input",{attrs:{name:"name",placeholder:"Username",type:"text"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),t._v(" "),n("span",{staticClass:"input-clear-button"})],1),t._v(" "),n("f7-list-item",[n("f7-input",{attrs:{name:"pass",type:"password",placeholder:"Password"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),t._v(" "),n("span",{staticClass:"input-clear-button"})],1)],1),t._v(" "),n("f7-list",[n("f7-list-button",{attrs:{"close-login-screen":""},on:{click:t.signInOut},model:{value:t.signInOutTitle,callback:function(e){t.signInOutTitle=e},expression:"signInOutTitle"}},[t._v(t._s(t.signInOutTitle))])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]}},224:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{title:"Incident","back-link":"Back",sliding:""}}),t._v(" "),n("f7-block-title"),t._v(" "),n("f7-block",{attrs:{strong:""}},[n("p",[t._v(" Vous allez etre rediriger vers le site ")]),t._v(" "),n("p",[t._v(" pour reporter l'incident")])])],1)},staticRenderFns:[]}}});
//# sourceMappingURL=app.913c61f51cb9c3ba7a19.js.map